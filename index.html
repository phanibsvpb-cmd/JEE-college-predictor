<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JEE College Predictor</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  margin: 0;
  color: #333;
}

.container {
  max-width: 950px;
  margin: auto;
  padding: 40px 20px;
}

.card {
  background: white;
  border-radius: 14px;
  padding: 30px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.15);
  margin-bottom: 30px;
}

h1, h2 {
  text-align: center;
  color: #203a43;
}

p {
  text-align: center;
  color: #555;
}

.buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
}

button {
  background: #203a43;
  color: white;
  border: none;
  padding: 14px 26px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}

button:hover {
  background: #2c5364;
}

input, select {
  width: 100%;
  padding: 14px;
  margin: 12px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 15px;
}

.hidden {
  display: none;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
  text-align: left;
}

th {
  background: #f4f7f9;
}

.download {
  background: #27ae60;
  margin-bottom: 15px;
}

.download:hover {
  background: #219150;
}

.footer {
  text-align: center;
  color: #ddd;
  font-size: 14px;
  margin-top: 30px;
}
</style>
</head>

<body>

<div class="container">

<!-- STEP 1 -->
<div class="card" id="step1">
  <h1>JEE College Predictor</h1>
  <p>Predict colleges based on JoSAA 2025 cutoffs</p>

  <div class="buttons">
    <button onclick="selectExam('main')">JEE Main</button>
    <button onclick="selectExam('advanced')">JEE Advanced</button>
  </div>
</div>

<!-- STEP 2 -->
<div class="card hidden" id="step2">
  <h2 id="formTitle"></h2>

  <input type="number" id="rank" placeholder="Enter your rank">

  <select id="gender">
    <option value="Gender-Neutral">Gender-Neutral</option>
    <option value="Female-only (including Supernumerary)">Female-only</option>
  </select>

  <select id="category">
    <option value="OPEN">OPEN</option>
    <option value="OBC-NCL">OBC-NCL</option>
    <option value="EWS">EWS</option>
    <option value="SC">SC</option>
    <option value="ST">ST</option>
  </select>

  <button onclick="predict()" style="width:100%;margin-top:10px;">
    Predict Colleges
  </button>
</div>

<!-- STEP 3 -->
<div class="card hidden" id="step3">
  <h2>Eligible Institutes & Programs</h2>
  <button class="download" onclick="downloadCSV()">Download Results</button>

  <table>
    <thead>
      <tr>
        <th>Institute</th>
        <th>Program</th>
        <th>Opening Rank</th>
        <th>Closing Rank</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>
</div>

<div class="footer">
  Â© 2025 JEE College Predictor
</div>

</div>

<script>
let selectedExam = "";
let finalResults = [];

function selectExam(exam) {
  selectedExam = exam;
  document.getElementById("step1").classList.add("hidden");
  document.getElementById("step2").classList.remove("hidden");

  document.getElementById("formTitle").innerText =
    exam === "main"
      ? "JEE Main College Predictor"
      : "JEE Advanced College Predictor";
}

function predict() {
  const rank = parseInt(document.getElementById("rank").value);
  const gender = document.getElementById("gender").value;
  const category = document.getElementById("category").value;

  if (!rank) {
    alert("Please enter a valid rank");
    return;
  }

  Papa.parse("Josaa 2025.csv", {
    download: true,
    header: true,
    complete: function(res) {
      finalResults = res.data.filter(row => {
        const open = parseInt(row["Opening Rank"]);
        const close = parseInt(row["Closing Rank"]);

        if (rank < open || rank > close) return false;
        if (row["Seat Type"] !== category) return false;
        if (row["Gender"] !== gender) return false;

        if (selectedExam === "advanced") {
          return row["Institute"].startsWith("Indian Institute of Technology");
        } else {
          return !row["Institute"].startsWith("Indian Institute of Technology");
        }
      });

      showResults();
    }
  });
}

function showResults() {
  document.getElementById("step2").classList.add("hidden");
  document.getElementById("step3").classList.remove("hidden");

  const tbody = document.getElementById("results");
  tbody.innerHTML = "";

  if (finalResults.length === 0) {
    tbody.innerHTML =
      "<tr><td colspan='4'>No colleges found for your rank</td></tr>";
    return;
  }

  finalResults.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row["Institute"]}</td>
      <td>${row["Academic Program Name"]}</td>
      <td>${row["Opening Rank"]}</td>
      <td>${row["Closing Rank"]}</td>
    `;
    tbody.appendChild(tr);
  });
}

function downloadCSV() {
  const csv = Papa.unparse(finalResults);
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "jee_college_predictions.csv";
  a.click();
}
</script>

</body>
</html>
